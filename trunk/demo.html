<!-- This is a demo to see on a desktop browser how your Wordpress mobile view will look like or if you want to share it or test on the Mobile simulator, user your demo.html - Mobile simulator http://www.itabbar.com/iphone-sim/iPhone-simulator.php -->
<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<!--<meta name="viewport" content="width=device-width,user-scalable=no" /> -->

<link rel="apple-touch-icon" href="img/iPhoneIcon_Small.png" />
<link rel="apple-touch-icon" sizes="72x72" href="img/iPhoneIcon_Medium.png" />
<link rel="apple-touch-icon" sizes="114x114" href="img/iPhoneIcon_Big.png" />
<title>WP apptouch Demo</title>

<style type="text/css">  

</style>

<!--<link rel="stylesheet" href="http://scripts.toolurl.com/mobile/1-tabbbar/themes/css/jqtouch.css"/> -->
<link rel="stylesheet" href="src/apple.css"/>
<link rel="stylesheet" href="src/itabbar.css"/><!--CSS order are important -->
<link rel="stylesheet" href="src/style.css"/>

<script type="text/javascript" src="src/iscroll.min.js"></script>
<script type='text/javascript' src='src/zepto.min.js'></script> 
<script type='text/javascript' src='src/jqtouch.min.js'></script>  

<script type='text/javascript' src='src/jqt.autotitles.min.js'></script>  

<script type="text/javascript">
var loc = window.location.pathname;
var dir = loc.substring(0, loc.lastIndexOf('/'));
//alert(dir);
var INDEX_URL = window.location.protocol + "//" + window.location.host + "/" + dir + "/";  // Main url

var BLOG_TITLE = 'WP-apptouch';
var BLOG_DESC = 'WP app-touch demo';

var myScroll;
function loaded() {
	myScroll = new iScroll('wrapper');
}

document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
document.addEventListener('DOMContentLoaded', setTimeout(function () { loaded(); }, 200), false);

//Add to home popup
if ('standalone' in navigator && !navigator.standalone && (/iphone|ipod|ipad/gi).test(navigator.platform) && (/Safari/i).test(navigator.appVersion)) {
		document.write('<link rel="stylesheet" href="\/src\/add2home.css">');
		document.write('<script type="application\/javascript" src="\/src\/add2home.js" charset="utf-8"><\/s' + 'cript>');
	}
</script>


<script type="text/javascript" charset="utf-8">
if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))){
	var jQT = new $.jQTouch({
   		//cacheGetRequests: false,
    	icon: 'img/iPhoneIcon_Medium.png',
    	icon4: 'img/iPhoneIcon_Big.png',
    	addGlossToIcon: false,
    	startupScreen: 'img/istartup.png',
    	//statusBar: 'black-translucent',
    	themeSelectionSelector: '#jqt #themes ul',
		statusBar: 'black-translucent',
		useFastTouch: true,
    	statusBar: 'default',
    	preloadImages: [
		'img/loading.gif',
		'img/iPhoneIcon_Medium.png',
		'img/pinstripes2.gif',
		'img/UIBack.png',
		'img/UIBackPressed.png',
		]
	});
	//alert('is iPhone');
} else {	
	var jQT = new $.jQTouch({
    	//statusBar: 'black-translucent',
    	themeSelectionSelector: '#jqt #themes ul',
		useFastTouch: false,
    	statusBar: 'default',
    	preloadImages: [
		'img/loading.gif',
		'img/iPhoneIcon_Medium.png',
		'img/pinstripes2.gif',
		'img/UIBack.png',
		'img/UIBackPressed.png',
		]
	});
	//alert('is not iPhone');
} 

sid = 0;
s = 0;

 var INDEX_URL = ''; // Main url
// Some sample Javascript functions:
$(function() {

	// Home view
	$('#home').bind('pageAnimationEnd', function(e, info) {

						if (myScroll) {
                            myScroll.destroy();
                            myScroll = null;
                        }

                        if ($('div#' + e.target.id + ' #wrapper').get(0)) {
                            setTimeout(function() {
                                myScroll = new iScroll($('div#' + e.target.id + ' #wrapper').get(0));
                                //alert('New iscroll');
                            }, 0);
                        }
		

		if (info.direction == 'in'){
		
		$("#single .toolbar H1").empty(); // empty single H1 title for autotitle
		$("#singleappend").empty();
		
		}

	}); //pageAnimationEnd



	// Page animations end with AJAX callback event, example 1 (load remote HTML only first time)
    $('#single').bind('pageAnimationEnd', function(e, info) {

		if (info.direction == 'in'){
		//alert('in do json')		
        var wp_url = INDEX_URL + 'get_single.php';

        showLoading();
		//alert('show loading')
		//$("#singleappend").empty().html('<div align="center"><img src="img/loading.gif" alt="Loading" width="32" height="32" id="imgloading" /></div>'); 
		
        $.getJSON(wp_url + '?&id=' + sid, function(data) {

            $.each(data.posts, function(i, post) {

                if (post.title !== undefined) {

                     if (myScroll) {

                        myScroll.destroy();
                        myScroll = null;

                    }

				   //Create new iScroll
				   if ($('div#' + e.target.id + ' #wrapper').get(0)) {
                        setTimeout(function() {
                            myScroll = new iScroll($('div#' + e.target.id + ' #wrapper').get(0));
                            //alert('New iscroll');
                        }, 0);
                    }


                    var post_html = '<ul class="edgefullcontent"><li class=""><div id="previous"><a class="singlenext" id="' + post.prev_post + '" href="#"><span class="nxtarrow"><</span> PREVIOUS</a></div><div id="next"><a class="singlenext" id="' + post.next_post + '" href="#">NEXT <span class="nxtarrow">></span> </a></div></li>';
					post_html += '<li class="blog-title">';
					post_html += '<span class="info_post" style=" float: right;  padding-right: 5px ;" > ' + post.category + '</span>';
                    post_html += '<span class="info_post">' + post.date + '</span>';
					post_html += '<h1>' + post.title + '</h1>';					
					if (post.fimg) post_html += post.fimg ;
                    post_html += '<p>' + post.content + '</p></li></ul>';
                    $('#singleappend').html(post_html);
					
					
					
					getid();

                } // if post.title !== undefined
				
				setTimeout(function () { // Refresh timOut if image in post with no definied size
				myScroll.refresh();
				}, 2000);
				
            }); //each
hideLoading();
        }); //getjson
		} //if direction in

    }); //pageAnimationEnd
	
// Categories List
$('#categories').bind('pageAnimationEnd', function(e, info) {

if (info.direction == 'in'){
	var sid = '';
 //alert('empty sid = '+sid);
	$("#postcat").empty();
	$("#showposts .toolbar H1").empty();
	//alert('H1 empty - postcat empty')
}

    if ((info.direction == 'in') && ($('ul#catappend').is(':empty'))) { //if empty load ajax
        //$("#catappend").empty();

            var wp_url = INDEX_URL + 'get_category.php';

			showLoading();

            $.getJSON(wp_url + '?', function(data) {
			
						if (myScroll) {
                            myScroll.destroy();
                            myScroll = null;
                        }

                        if ($('div#' + e.target.id + ' #wrapper').get(0)) {
                            setTimeout(function() {
                                myScroll = new iScroll($('div#' + e.target.id + ' #wrapper').get(0));
                                //alert('New iscroll');
                            }, 0);
                        }
						
                $.each(data.categories, function(i, categories) {

                    if (categories.cat_name !== undefined) {                     

                        var post_html = '<li class="blog-title arrow"><a onClick="send(' + categories.id + ')" id=' + categories.id + ' href="#showposts" class="cat">';
                        post_html += categories.cat_name + '</a></li>';
                        $('#catappend').append(post_html);
						
						

                    } // if post.title !== undefined
					
                }); //each
				hideLoading();
            }); //getjson
        
    } //direction in end
}); //pageAnimationEnd
	

// Post List
$('#showposts').bind('pageAnimationEnd', function(e, info) {

if ((info.direction == 'in') && ($('ul#postcat').html())) { //if not empty don't load ajax
$("#single .toolbar H1").empty(); // empty single H1 title for autotitle
$("#singleappend").empty();
  if (myScroll) {
 	myScroll.destroy();
    myScroll = null;
	//alert('destroy iscroll not empty')
  }

  if ($('div#' + e.target.id + ' #wrapper').get(0)) {
  	setTimeout(function() {
  	myScroll = new iScroll($('div#' + e.target.id + ' #wrapper').get(0));
    //alert('New iscroll');
    }, 0);
  }
}

	if ((info.direction == 'in') && ($('ul#postcat').is(':empty'))) { //if empty load ajax
	
	//alert('is empty')

            var wp_url = INDEX_URL + 'get_post.php';
			
			//alert('New sid = '+sid);
			showLoading();
			//alert('showloading');
			//var sid = $(this).attr('id'); 			
		
			$.getJSON(wp_url + '?&s='+s+'&id=' + sid, function(data) {
			//$.getJSON(wp_url + '?&id=' + sid, function(data) {
			//alert('getjson');
			
			 			if (myScroll) {
                            myScroll.destroy();
                            myScroll = null;
							//alert('destroy iscroll')
                        }

                        if ($('div#' + e.target.id + ' #wrapper').get(0)) {
                            setTimeout(function() {
                                myScroll = new iScroll($('div#' + e.target.id + ' #wrapper').get(0));
                                //alert('New iscroll');
                            }, 0);
                        }

                $.each(data.posts, function(i, post) {

                    if (post.title !== undefined) {
                        
						var post_html = '<li class="blog-title arrow"><a onClick="send(' + post.id + ')" id=' + post.id + ' href="#single">';	
                        post_html += post.get_thumb;
               			post_html += '<h2>' + post.title + '</h2>';
                		post_html += '<p>' + post.excerpt + '</p></a></li>';
						
						$('#postcat').append(post_html);						
	
                    } // if post.title !== undefined				

                }); //each
				hideLoading();
				//alert('hideloading');
            }); //getjson
		
    } //direction in end

}); //pageAnimationEnd

	$('#search').bind('pageAnimationEnd', function(e, info) {

		if (info.direction == 'in'){

			 			if (myScroll) {
                            myScroll.destroy();
                            myScroll = null;
							//alert('destroy iscroll')
                        }

                        if ($('div#' + e.target.id + ' #wrapper').get(0)) {
                            setTimeout(function() {
                                myScroll = new iScroll($('div#' + e.target.id + ' #wrapper').get(0));
                                //alert('New iscroll');
                            }, 0);
                        }
						
		$("#showposts .toolbar H1").empty(); // marche pas parce que pas encole loader, peut etre if direction out
		$("#postcat").empty();
		
		}

	}); //pageAnimationEnd


}); //end function()
</script>

<script type="text/javascript">			
// Home 
$(document).ready(function() {

    var wp_url = INDEX_URL + 'get_post.php';

    $.getJSON(wp_url + '?', function(data) {

        $.each(data.posts, function(i, post) {

            if (post.title !== undefined) {

                var post_html = '<li class="blog-title arrow"><a onClick="send(' + post.id + ')" id=' + post.id + ' href="#single">';
                //post_html += '<div class="float_right">' + post.date + '</div>';
                post_html += post.get_thumb;
                post_html += '<h2>' + post.title + '</h2>';
                post_html += '<p>' + post.excerpt + '</p></a></li>';

                // Append html string to container div 
                $('#allpost').append(post_html);
                //if ( i == 5 ) return false;      
            }
        });

        //var myScroll = new iScroll('wrapper', {checkDOMChanges: false} ); // Initialize the iScroll object
       	//var myScroll = new iScroll('wrapper');
			myScroll.refresh();

    });
	
}); // end document ready

</script>

<style type="text/css">

</style>
</head>

<body>
<div id="page">
<div id="jqt">

<!-- #home -->
	<div id="home" class="current">
		<div class="toolbar">
			<h1><script type="text/javascript">document.write(BLOG_TITLE);</script></h1>
			 <a class="button slideup" id="infoButton" href="#about">About</a>
        </div>
		<div id="wrapper">
			<div id="scroller">
			<ul class="edgecontent" id="allpost"></ul>
			</div>
		</div>
	</div>
<!-- End #home -->
    
<!-- #single -->
	<div id="single" class="">
		<div class="toolbar">
			<h1></h1>
            <a class="back" href="#">Back</a>		
        </div>
		<div id="wrapper">
			<div id="scroller">
            <div id="singleappend">         
            </div>         
            </div>
		</div>
	</div>
<!-- End #single -->

<!-- #categories -->
	<div id="categories">
		<div class="toolbar">
			<h1>Sections</h1>
		</div>
		<div id="wrapper">
			<div id="scroller">            
			<ul class="edgetoedge" id="catappend"></ul>
			</div>
		</div>
	</div>
<!-- End #categories -->

<!-- #showposts -->
	<div id="showposts">
		<div class="toolbar">
			<h1>Section</h1>
            <a class="back" href="#">Categories</a>		</div>
		<div id="wrapper">
			<div id="scroller">
			<ul class="edgecontent" id="postcat"></ul>
			</div>
		</div>
	</div>
<!-- End #showposts -->
  
 
<!-- #search -->
   <form id="search"  class="form">
		<div class="toolbar">
			<h1>Search</h1>
			 <a class="cancel" href="#">Cancel</a>
        </div>
				<div id="wrapper">
			<div id="scroller">
                    <ul class="rounded" id="dontscroll">
                        <li><input type="search" id="searchid" name="s" value="" placeholder="Search" /></li>
                    </ul>
                    <a style="margin-top: 10px; margin-bottom: 10px; color:rgba(0,0,0,.9)" href="#showposts" id="submit" class="whiteButton">Submit</a>
           			</div>
		</div>
    </form>
<!-- End #search -->
    
    <!-- #about -->
    <div id="about" class="selectable">
		<p><img src="http://wpapptouch.com/wp-content/uploads/apptouch-icon.png" /></p>
		<p><strong><a href="http://wpapptouch.com" target="_blank">WPapptouch.com</a></strong><br>
		  Version 0.1 beta<br>
	  <a href="http://wpapptouch.com" target="_blank">By Gino Côté</a></p>
	  <p><em>Create powerful Wordpress mobile web apps with<br> WPapptouch.</em></p>
		<p>
			<a target="_blank" href="http://twitter.com/wpapptouch">@wpapptouch on Twitter</a></p>
		<p><br><a href="#" class="grayButton goback">Close</a></p>
	</div>
    <!-- End #about -->

</div> <!-- End #jqt -->

<div id="loading"><p><img src="img/loading.gif" /></p></div>

<nav id="tabbar">
    <ul >
     <!-- Action & navigation -->
<li><a href="#home" class="current flip"><strong>Home</strong><div class="home"></div></a></li>    
<li><a href="#categories" class="flip"><strong>Sections</strong><div class="list"></div></a></li>
<li><a onClick="send('pages')" href="#showposts" class="flip"><small class="badge right">6</small><strong>Pages</strong><div class="page"></div></a></li>
<li><a href="#search" id="li_tab" class="flip"><strong>Search</strong><div class="search2"></div></a></li>
<li><a href="#about" id="li_tab" class="flip"><strong>More</strong><div class="more"></div></a></li>
    </ul>
</nav>
</div> <!-- End #page -->
<script type="text/javascript">

//ajax loading animation
function showLoading() {
  //$("div.container").show();
  $("#loading").show(); // If image gif
}

function hideLoading() {
  //$("div.container").hide();
  $("#loading").hide();  // If image gif
}

function send(x) {
    sid = x;
	//alert ('Fonction '+sid);
	if(isNaN(sid)){
	$("#showposts .toolbar H1").empty(); // marche pas parce que pas encole loader, peut etre if direction out
	$("#postcat").empty();
	//alert ('is not a number');
	}
	return false;
}
//Hack, ajax jsonp search
$("#submit").tap(function(e) { // onclick event to the submit button - .tap or .click.
    var s = $("#searchid").val(); // get the user-entered search term
	sget(s)
	//alert(s);
});

function sget(v) {
    s = v;
	//$("#postcat").empty();
}

function getid() {
$(".singlenext").click(function(e) { // onclick event to the submit button.
    //var s = $("#search").val(); // get the user-entered search term
	
	sid = (this.id);
    //alert(sid);
	//$("#singleappend").empty();

    //alert(myUrl);
    var wp_url = INDEX_URL + 'get_single.php';
	
	showLoading();

    $.getJSON(wp_url + '?&id=' + sid, function(data) {

        $.each(data.posts, function(i, post) {

            if (post.title !== undefined) {

                var post_html = '<ul class="edgefullcontent"><li class=""><div id="previous"><a class="singlenext" id="' + post.prev_post + '" href="#"><span class="nxtarrow"><</span> PREVIOUS</a></div><div id="next"><a class="singlenext" id="' + post.next_post + '" href="#">NEXT <span class="nxtarrow">></span> </a></div></li>';
				//var post_html = '<ul class="rounded"><li class=""><div class="singlenext" id="' + post.next_post + '">NEXT</div></li>';
                post_html += '<li class="blog-title">';
				post_html += '<span class="info_post" style=" float: right;  padding-right: 5px ;" > ' + post.category + '</span>';
                post_html += '<span class="info_post">' + post.date + '</span>';
				post_html += '<h1>' + post.title + '</h1>';					
				if (post.fimg) post_html += post.fimg ;
				//post_html += 'Cat: ' + post.category + ' ';
                post_html += '<p>' + post.content + '</p></li></ul>';
				
				var post_title = post.title ;
				
                //$("#single .toolbar H1").empty(); // empty single H1 title for autotitle
				$('#singleappend').html(post_html);
				$('#single .toolbar H1').html(post_title);
				
				hideLoading();
				getid();

            } // if post.title !== undefined
			setTimeout(function () { // Refresh timOut if image in post with no definied size
				myScroll.refresh();
				}, 2000);
        }); //each	
		
    }); //getjson
}); //end
}

var count = $("#tabbar li").length;
var pourcent = 100 / count;
$("#tabbar li").css("width", pourcent + "%");
//alert(pourcent);

var clickEventType=((document.ontouchstart!==null)?'click':'touchstart');

$("#tabbar a").bind(clickEventType, function() {
	$("#tabbar a").addClass("current").not(this).removeClass("current");
    //$("#tabbar div").addClass("current").not(this).removeClass("current");
});

//iscroll fix for form
var selectField = document.getElementById('dontscroll');
selectField.addEventListener('touchstart' /*'mousedown'*/, function(e) {
    e.stopPropagation();
}, false);
</script>

<script type='text/javascript' src='src/fullscreen.js'></script>  
</body>
</html>